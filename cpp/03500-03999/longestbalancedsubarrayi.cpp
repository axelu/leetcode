
// 3719. Longest Balanced Subarray I
// https://leetcode.com/problems/longest-balanced-subarray-i/description/




class Solution {
public:
    int longestBalanced(vector<int>& nums) {
        int n = nums.size(); // 1 <= n <= 1500
        if( n == 1 )
            return 0;

        int ans = 0;

        // 1 <= nums[i] <= 1e5
        // but because n <= 1500, worst case 1500 distinct integers
        // brute force small enough constraint

        int cnt[100001];memset(cnt,0,sizeof cnt); // 1 <= nums[i] <= 1e5
        int odd = 0;     // count of distinct odds
        int even = 0;    // count of distinct evens
        for(int i = 0; i < n; ++i) {
            bool is_odd = nums[i] % 2;
            ++cnt[nums[i]];
            if( cnt[nums[i]] == 1 ) {
                // we added a new distinct integer
                if( is_odd )
                    ++odd;
                else
                    ++even;
            }

            int diff = odd - even;
            if( diff == 0 )
                ans = i+1;
        }

        if( ans == n ) // we cannot do better than that
            return ans;

        if( !odd || !even ) // either no even or no odd numbers
            return 0;

        ans = max(ans, 2); // there is at least one pos in which odd meets even
        //cout << "preliminary ans " << ans << endl;

        // backtrack
        int j = n-1;
        for(;j >= ans; --j) {
            bool is_odd = nums[j] % 2;
            --cnt[nums[j]];
            if( cnt[nums[j]] == 0 ) {
                // we removed a distinct integer
                if( is_odd )
                    --odd;
                else
                    --even;
            }
        }
        //cout << "j after initial backtracking " << j << endl;

        // advanced alternating loop (still dumb brute force loop)
        // sliding window alternating expanding then shrinking
        int i = 0;
        while( n - i - 1 > ans ) {
            //cout << "begin i " << i << " j " << j << " odd " << odd << " even " << even << endl;

            // advance i
            bool is_numsi_odd = nums[i] % 2;
            --cnt[nums[i]];
            if( cnt[nums[i] ]== 0 ) {
                // we removed a distinct integer
                if( is_numsi_odd  )
                    --odd;
                else
                    --even;
            }
            ++i;
            //cout << "after initial i advance i " << i << " j " << j << " odd " << odd << " even " << even << endl;

            // loop expanding j till end
            ++j;
            for(; j < n; ++j) {
                bool is_numsj_odd = nums[j] % 2;
                ++cnt[nums[j]];
                if( cnt[nums[j]] == 1 ) {
                    // we added a new distinct integer
                    if( is_numsj_odd )
                        ++odd;
                    else
                        ++even;
                }

                int diff = odd - even;
                if( diff == 0 )
                    ans = j-i+1;
            }
            //cout << "after expanding j i " << i << " j " << j << " odd " << odd << " even " << even;
            //cout << " ans " << ans << endl;

            if( ans == j-i )
                break;

            --j; // we want j at n-1

            // advance i
            is_numsi_odd = nums[i] % 2;
            --cnt[nums[i]];
            if( cnt[nums[i]] == 0 ) {
                // we removed a distinct integer
                if( is_numsi_odd  )
                    --odd;
                else
                    --even;
            }
            ++i;
            //cout << "after second i advance i " << i << " j " << j << " odd " << odd << " even " << even;
            //cout << " ans " << ans << endl;

            // we need to check
            int diff = odd - even;
            if( diff == 0 ) {
                ans = j-i+1;
                break;
            }

            // loop shrinking j till ???
            for(; j >= i + ans; --j) {
                bool is_numsj_odd = nums[j] % 2;
                --cnt[nums[j]];
                if( cnt[nums[j]] == 0 ) {
                    // we removed a distinct integer
                    if( is_numsj_odd  )
                        --odd;
                    else
                        --even;
                }

                int diff = odd - even;
                if( diff == 0 ) {
                    --j;
                    ans = j-i+1;
                    break;
                }
            }
        }

        return ans;
    }
};



/* test cases

[2,5,4,3]
[3,2,2,5,4]
[1,2,3,2]
[1,1,1,1]
[2]
[10,6,10,7]
[1,1,1,2,3,2]
[1,1,1,2,1,2]

[1,1,1,2,1,1]
[1,1,1,2,3]
[1,2,3]
[1,2,3,2,1]
[35,19,28,43,41,2,28]
[28,51,9,21,21,52,3,30]
[8,32,38,39]
[18766,2654,96929,22970,59320,27371,79089,82843,38570,73999,41905,9606,15234,92146,66326,54817,8797,98634,5530,25963,29722,32214,74231,21075,48624,6631,54859,86233,97506,70778,2218,32623,73432,99147,71945,49103,26517,51033,31945,81438,41384,73850,7396,56617,82347,90073,27785,91143,88706,33314,33458,34780,81880,7688,55854,30503,14318,27064,33087,28175,14194,35305,60798,3977,50803,32742,53079,93671,126,85024,75108,41509,75225,82503,14478,73923,72575,58614,65065,77633,91928,14874,12412,73807,22561,84617,20661,53230,28033,53748,81405,42226,5404,58554,62554,56206,7647,15632,49876,24124,17007,41335,81985,8583,40190,12814,82505,29116,71427,63922,23100,63354,78795,51863,53512,17708,36480,74173,70937,80864,27920,68693,39441,33323,43598,1994,5880,51244,17625,72107,91720,34632,13441,73704,43214,69982,86517,42071,99098,57943,5992,38549,37649,84786,90412,91160,2493,26891,65332,89782,24106,9603,74826,63546,59277,18424,81891,65156,86019,99515,37262,77738,50498,67055,51441,10064,53388,54309,52134,68837,12252,58125,7386,49900,59262,97797,57411,78107,41039,39095,84240,65144,48697,59065,45041,24326,77488,26931,89481,79859,42797,43095,57596,93295,10149,25389,19710,63536,79697,71843,32373,91948,46319,56110,58199,21932,53906,31962,38,94944,71056,84277,76439,36104,59694,37831,60429,53533,64761,49910,33391,7557,9356,90987,17203,19504,32727,36912,99391,12423,25106,48115,20723,71424,4224,95273,93356,74481,27234,9745,85776,98289,10374,78566,50745,70067,16396,11173,23599,81156,77434,56990,5065,86789,64328,22267,22644,97054,59179,38387,9476,84284,86501,46550,72060,7077,41823,81767,97909,69056,91511,83685,83697,1884,78602,34441,88302,94998,61965,11901,92505,39399,85242,97569,42539,49569,36188,65183,46622,95366,3569,72449,96001,6421,18999,84412,29849,77173,82530,27758,46228,74041,27794,46276,92276,6395,97068,96930,1392,59033,8830,93897,14783,94071,7817,57321,43639,44004,22503,6612,55721,42423,95412,68074,65196,30762,68837,95044,7934,51367,39153,70514,41759,66946,16789,34034,89693,13857,47315,7436,89241,56144,17684,4023,66566,25501,61343,26556,85856,198,33167,41577,58972,44931,26002,24167,92044,94838,19211,99978,46204,58363,86843,87962,41661,19983,38348,47705,50191,85662,55140,39431,41806,72824,59805,24723,14676,21148,51279,531,37697,797,58459,96668,45727,84460,20835,37771,79298,56397,54100,25501,14759,40942,29815,72771,77276,68162,20475,27467,53823,91967,66897,11980,64790,26702,36703,95817,64201,4333,12699,1897,5129,71158,14916,67208,71969,35750,4978,51266,92146,75429,93119,23257,32722,39285,12379,9997,7446,49206,37463,77620,41172,20712,5952,22313,47413,59006,18129,27965,63338,30827,46213,68466,18336,61128,35673,90305,96878,57002,41570,5375,48782,51040,44983,81503,90324,57362,91500,14121,6567,28962,91741,64090,49673,14044,86402,13437,73049,4530,57753,52738,51708,3965,37555,70044,65093,89580,60348,78322,46581,18269,83696,95363,85661,45031,93217,75984,2392,84716,6457,25310,30030,98197,89399,96054,12240,92152,25843,1640,13033,83595,54377,64740,87560,8283,51135,52652,97862,11482,30973,60795,46103,31020,72509,31763,76050,65725,24098,94793,66793,30554,20102,96822,45102,25852,92875,73693,18003,18717,75332,31035,2312,46060,12127,6223,54343,63261,58874,52204,91095,6198,29350,37197,37217,1858,68959,29619,67583,9408,24411,34375,39962,60865,31196,85063,3068,40422,58756,21071,75491,50439,68457,94154,96499,80583,376,67193,60196,75601,35748,51290,81798,65098,88486,35366,66955,73796,81336,34537,83203,5747,85263,39516,82963,32810,24579,86030,73232,99686,23452,65074,50124,8261,75579,46622,5195,75954,13814,65390,67906,65914,16679,49703,31011,21516,1420,97965,11663,82756,48854,11218,4854,34116,50733,87816,66926,91663,90197,56509,91348,13649,37934,41472,38261,13512,88093,43455,5817,18259,8845,73722,524,41875,39776,31534,79743,41195,45850,91405,23950,94703,18974,28803,45171,69707,32970,12096,61369,23167,84956,52717,53167,22889,10540,91427,52752,14984,34881,58568,33242,60077,48641,50117,1952,88416,81650,81694,29610,27500,89450,69912,22202,8424,98714,67372,94482,31684,95819,55850,71202,97126,24918,24368,20014,35457,15794,89117,50441,67026,64036,34,27103,12676,50151,45406,1091,48152,43451,30701,75651,32900,16964,14205,57675,15677,97928,52156,63712,10099,24358,34913,7224,65627,75632,43590,17436,7777,32706,84228,91155,96742,613,18257,9417,50763,80014,26860,15267,23464,73912,7269,72715,90875,21473,30390,6551,35753,98897,86615,45851,39606,37879,53074,5233,29863,13015,22668,37639,45721,6895,28793,58814,7507,63401,84582,74622,43414,11441,6240,66877,85352,13508,55944,76226,34981,2685,99129,87085,1581,2095,32935,41187,56325,2360,62771,86187,15375,85438,23826,77447,8684,68970,36260,32542,32371,37193,23515,75784,48634,29754,59013,50337,43262,31308,42915,94594,33992,58395,81678,51924,60489,14612,9462,16813,33323,72232,3000,48697,74021,43177,42495,99056,12146,95106,31598,60868,32299,71464,36652,97284,1218,12016,47620,60831,59675,90534,55424,93666,48928,37101,45589,25768,68064,55051,58933,17738,43634,78284,82787,17655,21460,25281,16710,49957,20387,64659,10825,69037,36123,63828,66320,37340,92195,13939,14522,51869,20825,69945,45534,86104,23397,7474,11872,7812,78876,87156,25549,22510,65439,8335,56516,3250,49968,73225,53206,86706,37884,80382,55742,74006,44209,22061,27697,36403,35999,42218,88271,56823,28514,50156,42927,51910,73982,71150,76073,69209,74657,1621,8070,40095,26308,64585,59696,92627,37810,12901,79332,92045,9635,35073,82402,53843,57133,10098,6598,93131,68667,94868,66306,97180,61376,25584,65441,51709,13085,41513,37269,87741,59485,45339,44187,2144,9923,3882,94770,64084,33134,74101,56128,42768,9173,38529,12963,66305,64978,19560,75788,33644,30779,42093,47175,8506,84028,12615,60214,97112,70479,97483,1204,29964,42821,45390,32107,69095,65623,26877,33179,15108,977,5658,57876,26502,44187,87190,92806,25516,6749,84945,59160,37527,43389,22686,46033,27416,35301,22598,40879,5779,36432,42082,52094,95604,3823,84201,64699,85797,27429,14229,905,28405,19886,75132,71258,80424,62321,64064,5940,85421,49008,81451,22947,92397,4136,85331,36164,55788,7929,77043,61567,60712,35476,13660,56316,55651,14212,21014,57799,41640,51594,75055,86397,71479,50186,57654,68255,28858,38069,90546,14278,3429,71996,53577,12177,92483,55259,48340,48271,79539,41734,26189,40251,93562,56200,96566,65564,86764,33931,23362,28403,85524,98417,31151,73354,64954,5157,57960,93812,43225,48505,24441,46653,36852,94369,58829,45687,49628,7169,10309,29166,65254,36497,69416,58815,9048,82333,24378,12163,16263,47740,56918,18138,62508,88068,7844,27461,93224,65803,37624,36449,30660,62065,99453,67511,56433,58282,29549,22412,81802,39857,51578,63407,92705,37345,22222,1753,19678,62951,30267,52292,27042,87184,70430,89549,75252,94625,33362,84827,76779,70985,37627,7438,33049,37080,91301,5834,11713,20849,44597,9866,60706,96174,73272,53410,49871,11845,71514,69548,74796,1781,21839,1837,88964,8620,7738,80567,19596,41099,65394,96375,12083,3020,3812,61484,56451,11464,83669,84515,32313,28265,94380,9370,40791,84004,62779,90661,95848,34293,76560,70643,52425,98398,88832,41388,23370,12921,38307,59317,54019,3700,55691,82453,23071,75855,43936,95874,87318,43956,80388,35982,72221,91120,45351,13011,75123,8130,3671,70970,58774,80230,57965,27550,94979,63148,85289,34700,76068,23595,94017,46438,43646,66059,28890,83069,41913,89178,78942,45583,33133,75681,81564,5353,66800,26915,34715,41922,51396,54737,29244,26521,51318,3560,54070,46297,66707,39358,97348,42774,79305,7716,5563,22950,73775,34452,22370,32039,23629,1311,77621,73114,93344,75537,78466,60143,2451,13181,18417,70198,67917,64012,96718,19235,67571,67139,81883,34277,22848,95582,93402,2152,19650,98964,41454,9776,49767,63823,41814,73396,81486,35787,46509,74829,11323,41326,51323,30125,70858,86091,322,55127,66454,13391,90713,34024,80529,88947,84652,3376,84528,78053,5528,20529,93368,63333,30304,43135,27155,72118,32882,24992,7904,79390,16172,35578,37067,67495,65702,7925,69937,66023,79403,36391,79413,70115,86766,76293,59061,71418,79668,59940,49470,1547,80469,42838,64879,10772,85972,92034,99241,18853,33377,23496,14594,49549,59073,68012,17043,41126,92288,3331,23500,71690,56073,19264,58156,42839,95556,33568,14256,75224,93508,80077,93122,90328,22914,58001,17451,25237,66386,16692,60441,99762,56539,91386,49310,31964,59398,82704,73089,51685,2387,96589,23375,58459,15852,97882,17649,27760,31450,31904,19335,41309,11981,12456,31636,51246,86808,65438,76483,53193,98481,36923,69307,55020,28309,34968,3335,4058,17672,76423,55742,36410,89363,95468,94868,21567,93350,12517,49326,41151,60772,68660,82459,72752,97467,30446,23998,84275,95883,16832,53819,94364,70106,23125,65735,14766,58093,69069,18823,92116,61843,90917,28525,51206,86384,23392,72772,96085,52260,38449,37235,13032,23460,19693,2135,20926,50138,42484,21552,62373,59315,75371,56736,45773,98495,38822,60538,72939,7890,95713,65054,86084,86629,93578,37289,73012,33322,26412,85449,1933,64860,22683,14964,88319,58728,33451,25597,8865,75934,47148]

*/
